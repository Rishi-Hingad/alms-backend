{
 "allow_comments": 0,
 "allow_delete": 0,
 "allow_edit": 0,
 "allow_incomplete": 0,
 "allow_multiple": 0,
 "allow_print": 0,
 "anonymous": 1,
 "apply_document_permissions": 1,
 "banner_image": "/files/new-building-01.jpg",
 "button_label": "Save",
 "client_script": "function send_email(name, email_send_to) {\r\n    frappe.call({\r\n        method: \"alms_app.api.emailsService.email_sender\",\r\n        args: {\r\n            name: name,\r\n            email_send_to: email_send_to\r\n        },\r\n        callback: function (response) {\r\n            if (!response.exc) {\r\n                frappe.msgprint({\r\n                    title: \"Success\",\r\n                    indicator: \"green\",\r\n                    message: \"Email sent successfully!\"\r\n                });\r\n            } else {\r\n                frappe.msgprint({\r\n                    title: \"Error\",\r\n                    indicator: \"red\",\r\n                    message: response.exc || \"An unknown error occurred while sending the email.\",\r\n                });\r\n            }\r\n        },\r\n        error: function (error) {\r\n            frappe.msgprint({\r\n                title: \"Error\",\r\n                indicator: \"red\",\r\n                message: error.message || \"An unknown error occurred while sending the email.\",\r\n            });\r\n        },\r\n    });\r\n}\r\n\r\nfrappe.web_form.after_save = () => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const employee_details = params.get(\"employee_details\");\r\n    const finance_company = params.get(\"finance_company\");\r\n    const ref_no = frappe.web_form.doc.name;\r\n\r\n    if (!employee_details || !finance_company || !ref_no) {\r\n        frappe.msgprint({\r\n            title: \"Missing Information\",\r\n            indicator: \"orange\",\r\n            message: \"Required parameters are missing or not accessible.\"\r\n        });\r\n        return;\r\n    }\r\n\r\n    // Step 1: Check if Selected Vendor doc exists for the employee\r\n    frappe.call({\r\n        method: \"frappe.client.get_list\",\r\n        args: {\r\n            doctype: \"Selected Vendor\",\r\n            filters: { employee_details },\r\n            fields: [\"name\"]\r\n        },\r\n        callback: function (res) {\r\n            if (res.message && res.message.length > 0) {\r\n                const selected_vendor_name = res.message[0].name;\r\n\r\n                // Step 2: Fetch and update the existing doc\r\n                frappe.call({\r\n                    method: \"frappe.client.get\",\r\n                    args: {\r\n                        doctype: \"Selected Vendor\",\r\n                        name: selected_vendor_name\r\n                    },\r\n                    callback: function (getRes) {\r\n                        const doc = getRes.message;\r\n\r\n                        // Check if the finance_company already exists with same ref_no\r\n                        const exists = doc.selected_finance_company.some(row =>\r\n                            row.finance_company === finance_company && row.ref_no === ref_no\r\n                        );\r\n\r\n                        if (!exists) {\r\n                            doc.selected_finance_company.push({\r\n                                finance_company: finance_company,\r\n                                ref_no: ref_no\r\n                            });\r\n\r\n                            frappe.call({\r\n                                method: \"frappe.client.save\",\r\n                                args: { doc },\r\n                                callback: function () {\r\n                                    frappe.msgprint(\"Selected Vendor updated with new finance company.\");\r\n                                }\r\n                            });\r\n                        } else {\r\n                            frappe.msgprint(\"This finance company and ref_no already exist for the employee.\");\r\n                        }\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                // Step 3: Create new Selected Vendor doc with child table entry\r\n                frappe.call({\r\n                    method: \"frappe.client.insert\",\r\n                    args: {\r\n                        doc: {\r\n                            doctype: \"Selected Vendor\",\r\n                            employee_details: employee_details,\r\n                            selected_finance_company: [\r\n                                {\r\n                                    finance_company: finance_company,\r\n                                    ref_no: ref_no\r\n                                }\r\n                            ]\r\n                        }\r\n                    },\r\n                    callback: function () {\r\n                        frappe.msgprint(\"Selected Vendor created.\");\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    // Send email as before\r\n    send_email(employee_details, finance_company);\r\n};\r\n",
 "condition_json": "[]",
 "creation": "2025-06-11 14:43:21.518877",
 "custom_css": ".web-footer{\n    display:none;\n}\n\n.navbar{\n    display:none;\n}\n\n.success-footer{\n    display:none;\n}",
 "doc_type": "Car Quotation",
 "docstatus": 0,
 "doctype": "Web Form",
 "idx": 0,
 "is_standard": 1,
 "list_columns": [],
 "login_required": 0,
 "max_attachment_size": 24,
 "modified": "2025-06-14 12:21:38.491516",
 "modified_by": "Administrator",
 "module": "CRMS",
 "name": "vendor-assets-quotation",
 "owner": "Administrator",
 "published": 1,
 "route": "vendor-assets-quotation",
 "show_attachments": 0,
 "show_list": 0,
 "show_sidebar": 0,
 "success_message": "Your Assets Quotation Form has been submitted successfully!!",
 "success_title": "Thank You!!!",
 "title": "Vendor Assets Quotation",
 "web_form_fields": [
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "employee_details",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Employee Details",
   "max_length": 0,
   "max_value": 0,
   "options": "Employee Master",
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "finance_company",
   "fieldtype": "Select",
   "hidden": 0,
   "label": "Finance Company",
   "max_length": 0,
   "max_value": 0,
   "options": "-Select-\nEasy Assets\nALD\nXYZ",
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "car_quotation_section",
   "fieldtype": "Section Break",
   "hidden": 0,
   "label": "Car Quotation",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "location",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Location",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "kms",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "KMS",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "variant",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Variant",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "quote",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Quote",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "interest_rate",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Interest Rate",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "tenure",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Tenure",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "base_price_excluding_gst",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Base Price Excluding GST",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "gst",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "GST",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "ex_showroom_amount",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Ex-Showroom Amount",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "accessory",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Accessory",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "discount_excluding_gst",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Discount (Excluding GST)",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "base_price_less_discounts",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Base Price Less Discounts",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "total_discount",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Total Discount",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "ex_showroom_amount_net_of_discount",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Ex-Showroom Amount(Net of Discount)",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "",
   "fieldtype": "Column Break",
   "hidden": 0,
   "label": "",
   "max_length": 0,
   "max_value": 0,
   "options": "",
   "precision": "",
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "registration_charges",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Registration Charges",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "residual_value_percent",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Residual Value Percent",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "financed_amount",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Financed Amount",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 1,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "residual_value",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Residual Value",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "emi_financing",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "EMI (Financing)",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "finance_emi_road_tax",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Finance EMI - Road Tax",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "gst_and_cess",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "GST and Cess",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "insurance",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Insurance",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "fleet_management_repairs_and_tyres",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Fleet Management (Repairs and Tyres)",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "24x7_assist",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "24x7 Assist",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "pickup_and_drop",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Pickup & Drop",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "std_relief_car_non_accdt",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Std Relief Car (Non Accdt)",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "gst_on_fms",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "GST on FMS",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "total_emi",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Total EMI",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  }
 ]
}